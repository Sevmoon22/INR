<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ThromboLogic INR</title>

<style>
:root{
  --blue:#eaf3ff; --blue-ring:rgba(13,110,253,.25);
  --ylw:#fffef0; --man:#ffe79a; --man-b:#ffc857;
  --card:#fafafa
}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:16px;color:#111}
h1{font-size:20px;margin:0 0 6px}
h2{font-size:15px;margin:16px 0 6px}
.small{font-size:12px;color:#555}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}

input,select,textarea,button{
  font-size:15px;
  padding:8px;
  border-radius:10px;
  border:1px solid #b9c1cc;
}
textarea{resize:vertical;min-height:84px}
button{cursor:pointer;border:0;background:#444;color:#fff}
.btn{padding:8px 12px;border-radius:10px}
.btnS{padding:4px 8px;border-radius:8px;font-size:13px}
.btnp{padding:10px 14px;border-radius:10px;background:#0d6efd;font-weight:700}
button:disabled{opacity:.5;cursor:not-allowed}

.container{max-width:860px;margin:0 auto}

fieldset{border:1px solid #ddd;border-radius:10px;padding:10px;margin:10px 0}
legend{padding:0 6px}

.grid{display:grid;gap:10px}
@media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

.grid7{display:grid;grid-template-columns:repeat(7,minmax(64px,1fr));gap:6px}
.grid7>div{display:flex;flex-direction:column;align-items:center}
.grid7 input{width:84px;text-align:center}

.legend{display:flex;gap:12px;font-size:12px;margin:6px 0}
.sw{width:14px;height:14px;border-radius:3px;display:inline-block;margin-right:4px}

.calwrap{
  border:1px solid #eee;border-radius:12px;
  max-height:70vh;overflow:auto;background:#fff
}
.weekHeader{
  position:sticky;top:0;background:#fff;
  border-bottom:1px solid #eee;
  padding:8px 12px;z-index:2;
  display:flex;justify-content:space-between;align-items:center
}
.week{
  display:grid;
  grid-template-columns:repeat(7,minmax(90px,1fr));
  gap:8px;padding:10px;border-bottom:1px solid #f0f0f0
}
.day{
  background:var(--ylw);
  border-radius:10px;padding:6px;
  min-height:148px;display:flex;flex-direction:column
}
.day.blue{background:var(--blue);box-shadow:inset 0 0 0 2px var(--blue-ring)}
.day.manual{background:var(--man);box-shadow:inset 0 0 0 2px var(--man-b)}
.orangeCell{background:#ffe0b3!important;box-shadow:inset 0 0 0 2px #ff9800}
.redCell{background:#ffc2c2!important;box-shadow:inset 0 0 0 2px #e53935}

.hdr{display:flex;justify-content:space-between;font-size:12px}
.lbl{text-align:center;font-size:11px;margin-top:2px}
.cell-input{margin:4px auto;text-align:center;width:84px}
.inrbox{font-weight:800}
.repeat-inr{text-align:center;font-size:11px;color:#b00020}

.card{border:1px solid #eee;border-radius:10px;padding:10px;background:var(--card)}
.err{color:#b00020;font-size:12px}
.debug{font-size:11px;color:#666}

.badge{display:inline-flex;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid #ddd;font-size:12px}
.badge.major{border-color:#e53935}
.badge.mod{border-color:#ff9800}
.badge.bleed{border-color:#7b1fa2}
</style>
</head>

<body>
<div class="container">

<h1>ThromboLogic <span class="small">INR 7.1</span></h1>
<div id="err" class="err"></div>

<h2>Baseline Maintenance Dosing</h2>
<fieldset>
<div class="grid7">
  <div>Sun<input id="b0" type="number" step="0.1"></div>
  <div>Mon<input id="b1" type="number" step="0.1"></div>
  <div>Tue<input id="b2" type="number" step="0.1"></div>
  <div>Wed<input id="b3" type="number" step="0.1"></div>
  <div>Thu<input id="b4" type="number" step="0.1"></div>
  <div>Fri<input id="b5" type="number" step="0.1"></div>
  <div>Sat<input id="b6" type="number" step="0.1"></div>
</div>
<button class="btn" id="applyCur">Apply to visible weeks</button>
<button class="btn" id="clearVisible">Clear visible</button>
<button class="btn" id="clearAll">Clear all</button>
<div id="sum" class="small"></div>
</fieldset>

<div class="legend">
  <span><span class="sw" style="background:var(--blue)"></span>Today / Repeat INR</span>
  <span><span class="sw" style="background:var(--man)"></span>Manual entry</span>
  <span><span class="sw" style="background:var(--ylw)"></span>Default</span>
</div>

<!-- LIVE CALENDAR -->
<h2>Scrollable Live Calendar</h2>
<div class="calwrap" id="calwrap">
  <div class="weekHeader">
    <b>Scroll for past / future weeks</b>
    <button class="btnS" id="goToday">Go to today</button>
  </div>
  <div id="weeks"></div>
</div>
<div id="dbg" class="debug"></div>

<!-- BRIDGING -->
<h2>Bridging â€“ Parenteral Helper</h2>
<fieldset>
<label>Weight (kg)</label>
<input id="enoxWeight" type="number" step="0.1">
<button class="btnS" id="calcEnox">Calculate</button>
<div id="enoxOut" class="small"></div>
</fieldset>

<!-- INTERACTIONS -->
<h2>Warfarin Interaction Check</h2>
<fieldset>
<textarea id="medsInput" placeholder="Bactrim, Metronidazole, Ibuprofen"></textarea>
<button class="btnS" id="runInteraction">Check</button>
<div id="interactionOut" class="small"></div>
</fieldset>

<!-- RECOMMENDATION -->
<h2>Verbal Recommendation</h2>
<div id="rec" class="card"></div>

<h2>7-Day Linear Summary</h2>
<div id="lin" class="card mono"></div>

<script>
/* ========= DATE HELPERS ========= */
const pad=n=>n<10?'0'+n:n;
const iso=d=>d.getFullYear()+'-'+pad(d.getMonth()+1)+'-'+pad(d.getDate());
const addDays=(d,n)=>{const x=new Date(d);x.setDate(x.getDate()+n);return x};
const startOfWeek=d=>addDays(d,-d.getDay());

/* ========= STATE ========= */
const weeksEl=document.getElementById('weeks');
const calwrap=document.getElementById('calwrap');
const planned=new Map(), actual=new Map(), inrVal=new Map();
let repeatKey=null;

/* ========= BASE ========= */
const base=()=>[0,1,2,3,4,5,6].map(i=>parseFloat(document.getElementById('b'+i).value)||0);
const updSum=()=>document.getElementById('sum').innerHTML='Weekly total: <b>'+base().reduce((a,b)=>a+b,0).toFixed(1)+' mg</b>';

/* ========= CALENDAR ========= */
const today=new Date();
const weeksBefore=26,weeksAfter=26;
const start=addDays(startOfWeek(today),-7*weeksBefore);
const totalWeeks=weeksBefore+weeksAfter+1;

function renderAll(){
  weeksEl.innerHTML='';
  for(let w=0;w<totalWeeks;w++){
    const wk=document.createElement('div');wk.className='week';
    for(let d=0;d<7;d++){
      const date=addDays(start,w*7+d);
      const key=iso(date);
      const cell=document.createElement('div');
      cell.className='day'; cell.id='c_'+key;
      if(key===iso(today))cell.classList.add('blue');
      cell.innerHTML=`
        <div class="hdr"><b>${['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][date.getDay()]}</b>
        <span>${pad(date.getMonth()+1)}/${pad(date.getDate())}</span></div>
        <div class="lbl">Planned</div><input class="cell-input" data-k="${key}" data-r="p">
        <div class="lbl">INR</div><input class="cell-input inrbox" data-k="${key}" data-r="i">
        <div class="lbl">Actual</div><input class="cell-input" data-k="${key}" data-r="a">
        <div class="repeat-inr">${key===repeatKey?'Repeat INR':''}</div>`;
      wk.appendChild(cell);
    }
    weeksEl.appendChild(wk);
  }
  document.getElementById('dbg').textContent='Weeks rendered: '+totalWeeks;
}

/* ========= EVENTS ========= */
weeksEl.addEventListener('input',e=>{
  const k=e.target.dataset.k,r=e.target.dataset.r;
  if(!k)return;
  const v=parseFloat(e.target.value);
  if(isNaN(v)){planned.delete(k);actual.delete(k);inrVal.delete(k);return;}
  if(r==='p')planned.set(k,v);
  if(r==='a')actual.set(k,v);
  if(r==='i')inrVal.set(k,v);
});

document.getElementById('applyCur').onclick=()=>{
  const b=base();
  document.querySelectorAll('.day').forEach((c,i)=>{
    planned.set(c.id.slice(2),b[i%7]);
  });
};
document.getElementById('clearVisible').onclick=()=>{planned.clear();actual.clear();inrVal.clear();renderAll()};
document.getElementById('clearAll').onclick=()=>{planned.clear();actual.clear();inrVal.clear();renderAll()};
document.getElementById('goToday').onclick=()=>document.getElementById('c_'+iso(today))?.scrollIntoView({block:'center'});

/* ========= INIT ========= */
document.addEventListener('DOMContentLoaded',()=>{
  try{renderAll();updSum();}
  catch(e){document.getElementById('err').textContent=e.message;}
});
</script>

</div>
</body>
</html>
